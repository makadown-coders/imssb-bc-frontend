<!-- projects/ti-admin/src/app/shared/edit-dispositivo.dialog.html -->
<div mat-dialog-title>Editar dispositivo</div>

<div mat-dialog-content class="p-16">
  <form [formGroup]="f">
    <mat-form-field class="full" appearance="fill">
      <mat-label># Serie</mat-label>
      <input matInput formControlName="serial" />
    </mat-form-field>

    <!-- Marca + Modelo -->
    <div class="grid-2">
      <mat-form-field appearance="fill">
        <mat-label>Marca</mat-label>
        <input matInput formControlName="marca" />
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Modelo</mat-label>
        <input matInput formControlName="modelo" />
      </mat-form-field>
    </div>

    <!-- IP + Conexión -->
    <div class="grid-2">
      <mat-form-field appearance="fill">
        <mat-label>IP</mat-label>
        <input matInput formControlName="ip" />
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Conexión</mat-label>
        <input matInput formControlName="conexion" />
      </mat-form-field>
    </div>

    <mat-form-field class="full" appearance="fill">
      <mat-label>Observaciones</mat-label>
      <textarea matInput rows="3" formControlName="observaciones"></textarea>
    </mat-form-field>
  </form>

  <h3 class="mat-dialog-title" style="margin:8px 0 4px;">Direcciones MAC</h3>

  <!-- Lista -->
  <div *ngIf="macs().length; else noMacs" class="grid-2">
    <div class="mac-row" *ngFor="let m of macs(); let i = index">
      <mat-icon>memory</mat-icon>
      <code class="muted">{{ m.mac }}</code>

      <!-- solo mostramos el tipo como chip -->
      <span class="mac-chip" *ngIf="m.kind as k">
        <mat-icon class="chip-icn">label</mat-icon>
        {{ k }}
      </span>

      <span class="spacer"></span>

      <button mat-icon-button (click)="removeMac(i)" aria-label="Quitar MAC">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>
  <ng-template #noMacs>
    <div class="muted" style="margin:4px 0 8px;">Sin MACs registradas.</div>
  </ng-template>

  <!-- Alta rápida: MAC + Tipo + Agregar -->
  <div class="grid-mac" style="margin:8px 0 16px;">
    <mat-form-field appearance="fill">
      <mat-label>Nueva MAC</mat-label>
      <input matInput [ngModel]="newMac()" (ngModelChange)="onNewMacChange($event)" [ngModelOptions]="{standalone:true}"
        placeholder="AA:BB:CC:DD:EE:FF, d0ad.0859.30f7, D0-AD-08-59-30-F7" (keyup.enter)="canAddMac() && addMac()"
        aria-describedby="mac-hint mac-error" />

      <!-- Hints según el estado -->
      <mat-hint id="mac-hint" *ngIf="!newMac()?.trim()">
        Escribe la MAC y pulsa <b>Agregar</b>.
      </mat-hint>

      <mat-hint id="mac-hint" *ngIf="canAddMac()">
        Se guardará como <b>{{ macPreview() }}</b>. Si olvidas darle a <b>Agregar</b>,
        la agregaremos automáticamente al <b>Guardar</b>.
      </mat-hint>

      <!-- Error accesible -->
      <mat-error id="mac-error" *ngIf="macError()">{{ macError() }}</mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Tipo</mat-label>
      <mat-select [value]="newKind()" (valueChange)="newKind.set($event)">
        <mat-option value="ethernet">Ethernet</mat-option>
        <mat-option value="wifi">Wi-Fi</mat-option>
        <mat-option value="mgmt">Gestión</mat-option>
        <mat-option value="bt">Bluetooth</mat-option>
        <mat-option value="other">Otro</mat-option>
      </mat-select>
    </mat-form-field>

    <button mat-flat-button color="primary" type="button" (click)="addMac()" [disabled]="!canAddMac()">
      <mat-icon>add</mat-icon>&nbsp;Agregar
    </button>
  </div>
</div>

<div mat-dialog-actions align="end">
  <button mat-stroked-button type="button" (click)="close()">Cancelar</button>
  <button mat-flat-button color="primary" type="button"
    [disabled]="f.invalid || saving || (!!newMac().trim() && !!macError())" (click)="save()" cdkFocusInitial>
    Guardar
  </button>
</div>