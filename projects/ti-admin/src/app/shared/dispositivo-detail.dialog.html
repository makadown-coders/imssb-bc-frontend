<!-- projects/ti-admin/src/app/shared/dispositivo-detail.dialog.html -->
<!-- CABECERA (tal como la tienes) -->
<div class="detail-header mat-elevation-z2 surface-card"
    style="padding:16px; display:flex; align-items:center; gap:12px;">
    <mat-icon class="type-icon" style="font-size:24px;margin-right: 24px;">
        {{ iconForTipo(vm.tipo) }}
    </mat-icon>

    <div style="flex:1;">
        <div class="mat-title-medium">{{ title }}</div>
        <div class="mat-body-medium">
            Serie: <strong>{{ vm.serie || '—' }}</strong> · Unidad: <strong>{{ vm.ubicacion || '—' }}</strong>
        </div>
        <div class="mat-body-medium">
            Responsable/Lugar: <strong>{{ vm.responsable_id || '—' }}</strong>
        </div>
    </div>

    <!-- Chip clickable que abre menú -->
    <button class="chip" [ngClass]="estadoView(vm.estado).cls" [matMenuTriggerFor]="estadoMenu"
        [disabled]="changingEstado" matRipple aria-label="Cambiar estado">
        <mat-icon class="chip-icn">{{ estadoView(vm.estado).icon }}</mat-icon>
        <span class="chip-label">{{ estadoView(vm.estado).label }}</span>
        <mat-icon class="chip-icn">arrow_drop_down</mat-icon>
    </button>

    <mat-menu #estadoMenu="matMenu">
        <button mat-menu-item *ngFor="let e of estadoOpts()" (click)="setEstado(e)" [disabled]="changingEstado">
            <mat-icon>{{ e.icon }}</mat-icon>
            <span>{{ e.label }}</span>
            <span class="spacer"></span>
            <mat-icon *ngIf="isActiveEstado(e)">check</mat-icon>
        </button>
    </mat-menu>

    <button mat-icon-button (click)="close()" aria-label="Cerrar">
        <mat-icon>close</mat-icon>
    </button>
</div>

<!-- CONTENIDO con manejo de alto y scroll -->
<div class="dd-content">
    <mat-divider class="dd-divider"></mat-divider>

    <!-- tabs -->
    <div class="dd-tabs-wrap">
        <mat-tab-group class="dd-tabs" [selectedIndex]="tabIndex()" (selectedIndexChange)="tabIndex.set($event)">
            <!-- TAB: Resumen -->
            <mat-tab label="Resumen">
                <div class="dd-tab-scroll">
                    <div class="dd-section-toolbar">
                        <span class="dd-spacer"></span>
                        <button mat-stroked-button color="primary" (click)="editResumen()">
                            <mat-icon>edit</mat-icon>&nbsp;Editar
                        </button>
                        <button mat-flat-button color="primary" (click)="cambiarAsignacion()">
                            <mat-icon>sync_alt</mat-icon>&nbsp;Cambiar responsable/lugar
                        </button>
                    </div>

                    <table class="kv" style="margin-top:36px;">
                        <tr>
                            <td>Marca / Modelo</td>
                            <td>&nbsp;&nbsp;</td>
                            <td>
                                <strong>{{ detail()?.marca || '—' }}</strong>
                                <ng-container *ngIf="detail()?.modelo"> · {{ detail()?.modelo }}</ng-container>
                            </td>
                        </tr>

                        <tr>
                            <td>IP / Conexión</td>
                            <td>&nbsp;&nbsp;</td>
                            <td>
                                <span>{{ detail()?.ip || '—' }}</span>
                                <ng-container *ngIf="detail()?.conexion"> · {{ detail()?.conexion }}</ng-container>
                            </td>
                        </tr>

                        <tr>
                            <td>Observaciones</td>
                            <td>&nbsp;&nbsp;</td>
                            <td>{{ detail()?.observaciones || '—' }}</td>
                        </tr>
                        <tr>
                            <td>&nbsp;&nbsp;</td>
                            <td>&nbsp;&nbsp;</td>
                            <td>&nbsp;&nbsp;</td>
                        </tr>
                        <tr>
                            <td>MACs</td>
                            <td>&nbsp;&nbsp;</td>
                            <td>
                                <ng-container *ngIf="nicList().length; else noNics">
                                    <span class="mac-chip" *ngFor="let n of nicList()"
                                        style="margin-right:8px;margin-bottom:6px;display:inline-flex;">
                                        <mat-icon class="chip-icn">memory</mat-icon>
                                        {{ n.mac }}
                                        <span class="muted" *ngIf="n.kind">&nbsp;· {{ n.kind }}</span>
                                    </span>
                                </ng-container>
                                <ng-template #noNics>—</ng-template>
                            </td>
                        </tr>
                    </table>
                </div>
            </mat-tab>

            <!-- TAB: Monitores -->
            <mat-tab label="Monitores" *ngIf="detail()?.monitores?.length  || true">
                <div class="dd-tab-scroll">
                    <div class="dd-section-toolbar">
                        <div class="dd-section-title">Monitores</div>
                        <span class="dd-spacer"></span>
                        <button mat-flat-button color="primary" (click)="addMonitor()">
                            <mat-icon>add</mat-icon>&nbsp;Agregar monitor
                        </button>
                    </div>

                    <table mat-table [dataSource]="detail()?.monitores ?? []" class="inv-table">
                        <ng-container matColumnDef="serial">
                            <th mat-header-cell *matHeaderCellDef>Serie</th>
                            <td mat-cell *matCellDef="let m">{{ m.serial || '—' }}</td>
                        </ng-container>
                        <ng-container matColumnDef="marca">
                            <th mat-header-cell *matHeaderCellDef>Marca</th>
                            <td mat-cell *matCellDef="let m">{{ m.marca || '—' }}</td>
                        </ng-container>
                        <ng-container matColumnDef="modelo">
                            <th mat-header-cell *matHeaderCellDef>Modelo</th>
                            <td mat-cell *matCellDef="let m">{{ m.modelo || '—' }}</td>
                        </ng-container>
                        <ng-container matColumnDef="principal">
                            <th mat-header-cell *matHeaderCellDef>Principal</th>
                            <td mat-cell *matCellDef="let m">
                                <mat-icon>{{ m.es_principal ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
                            </td>
                        </ng-container>

                        <!-- Acciones -->
                        <ng-container matColumnDef="acciones">
                            <th mat-header-cell *matHeaderCellDef class="th-actions">Acciones</th>
                            <td mat-cell *matCellDef="let m" class="td-actions">
                                <button mat-icon-button (click)="editMonitor(m)" matTooltip="Editar monitor">
                                    <mat-icon>edit</mat-icon>
                                </button>
                                <button mat-icon-button color="warn" (click)="deleteMonitor(m)"
                                    matTooltip="Eliminar monitor">
                                    <mat-icon>delete</mat-icon>
                                </button>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="['serial','marca','modelo','principal','acciones']"></tr>
                        <tr mat-row *matRowDef="let r; columns: ['serial','marca','modelo','principal','acciones'];">
                        </tr>
                    </table>
                </div>
            </mat-tab>

            <!-- TAB: Periféricos -->
            <mat-tab label="Periféricos" *ngIf="detail()?.perifericos?.length || true">
                <div class="dd-tab-scroll">
                    <div class="dd-section-toolbar">
                        <div class="dd-section-title">Periféricos</div>
                        <span class="dd-spacer"></span>
                        <button mat-flat-button color="primary" (click)="addPeriferico()">
                            <mat-icon>add</mat-icon>&nbsp;Agregar periférico
                        </button>
                    </div>

                    <table mat-table [dataSource]="detail()?.perifericos ?? []" class="inv-table">
                        <ng-container matColumnDef="tipo">
                            <th mat-header-cell *matHeaderCellDef>Tipo</th>
                            <td mat-cell *matCellDef="let p">{{ p.tipo || '—' }}</td>
                        </ng-container>
                        <ng-container matColumnDef="serial">
                            <th mat-header-cell *matHeaderCellDef>Serie</th>
                            <td mat-cell *matCellDef="let p">{{ p.serial || '—' }}</td>
                        </ng-container>
                        <ng-container matColumnDef="marca">
                            <th mat-header-cell *matHeaderCellDef>Marca</th>
                            <td mat-cell *matCellDef="let p">{{ p.marca || '—' }}</td>
                        </ng-container>
                        <ng-container matColumnDef="modelo">
                            <th mat-header-cell *matHeaderCellDef>Modelo</th>
                            <td mat-cell *matCellDef="let p">{{ p.modelo || '—' }}</td>
                        </ng-container>

                        <!-- Acciones -->
                        <ng-container matColumnDef="acciones">
                            <th mat-header-cell *matHeaderCellDef class="th-actions">Acciones</th>
                            <td mat-cell *matCellDef="let m" class="td-actions">
                                <button mat-icon-button (click)="editPeriferico(m)" matTooltip="Editar periférico">
                                    <mat-icon>edit</mat-icon>
                                </button>
                                <button mat-icon-button color="warn" (click)="deletePeriferico(m)"
                                    matTooltip="Eliminar Periférico">
                                    <mat-icon>delete</mat-icon>
                                </button>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="['tipo','serial','marca','modelo','acciones']"></tr>
                        <tr mat-row *matRowDef="let r; columns: ['tipo','serial','marca','modelo','acciones'];"></tr>
                    </table>
                </div>
            </mat-tab>
        </mat-tab-group>
        <!-- Overlay de carga (no destruye el tab-group) -->
        <div class="dd-loading-ov" *ngIf="loading()">
            <mat-spinner diameter="32"></mat-spinner>
        </div>
    </div>
</div>