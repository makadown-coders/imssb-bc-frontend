<!-- CABECERA (tal como la tienes) -->
<div class="detail-header mat-elevation-z2 surface-card"
    style="padding:16px; display:flex; align-items:center; gap:12px;">
    <mat-icon class="type-icon" style="font-size:24px;margin-right: 24px;">
        {{ iconForTipo(vm.tipo) }}
    </mat-icon>

    <div style="flex:1;">
        <div class="mat-title-medium">{{ title }}</div>
        <div class="mat-body-medium">
            Serie: <strong>{{ vm.serie || '—' }}</strong> · Unidad: <strong>{{ vm.ubicacion || '—' }}</strong>
        </div>
        <div class="mat-body-medium">
            Responsable/Lugar: <strong>{{ vm.responsable_id || '—' }}</strong>
        </div>
    </div>

    <span class="chip" [ngClass]="estadoView(vm.estado).cls">
        <mat-icon class="chip-icn">{{ estadoView(vm.estado).icon }}</mat-icon>
        <span class="chip-label">{{ estadoView(vm.estado).label }}</span>
    </span>

    <button mat-icon-button (click)="close()" aria-label="Cerrar">
        <mat-icon>close</mat-icon>
    </button>
</div>

<!-- CONTENIDO con manejo de alto y scroll -->
<div class="dd-content">
    <mat-divider class="dd-divider"></mat-divider>

    <!-- loader -->
    <ng-container *ngIf="loading(); else tabs">
        <div class="dd-loading">
            <mat-spinner diameter="32"></mat-spinner>
        </div>
    </ng-container>

    <!-- tabs -->
    <ng-template #tabs>
        <mat-tab-group class="dd-tabs">
            <!-- TAB: Resumen -->
            <mat-tab label="Resumen">
                <div class="dd-tab-scroll">
                    <div class="dd-section-toolbar">                        
                        <span class="dd-spacer"></span>
                        <button mat-stroked-button color="primary" (click)="editResumen()">
                            <mat-icon>edit</mat-icon>&nbsp;Editar
                        </button>
                        <button mat-flat-button color="primary" (click)="cambiarAsignacion()">
                            <mat-icon>sync_alt</mat-icon>&nbsp;Cambiar responsable/lugar
                        </button>
                    </div>

                    <table class="kv">
                        <tr>
                            <td>IP</td>
                            <td>{{ detail()?.ip || '—' }}</td>
                        </tr>
                        <tr>
                            <td>Conexión</td>
                            <td>{{ detail()?.conexion || '—' }}</td>
                        </tr>
                        <tr>
                            <td>Observaciones</td>
                            <td>{{ detail()?.observaciones || '—' }}</td>
                        </tr>
                    </table>
                </div>
            </mat-tab>

            <!-- TAB: Monitores -->
            <mat-tab label="Monitores" *ngIf="detail()?.monitores?.length || true">
                <div class="dd-tab-scroll">
                    <div class="dd-section-toolbar">
                        <div class="dd-section-title">Monitores</div>
                        <span class="dd-spacer"></span>
                        <button mat-flat-button color="primary" (click)="addMonitor()">
                            <mat-icon>add</mat-icon>&nbsp;Agregar monitor
                        </button>
                    </div>

                    <table mat-table [dataSource]="detail()?.monitores ?? []" class="inv-table">
                        <ng-container matColumnDef="serial">
                            <th mat-header-cell *matHeaderCellDef>Serie</th>
                            <td mat-cell *matCellDef="let m">{{ m.serial || '—' }}</td>
                        </ng-container>
                        <ng-container matColumnDef="marca">
                            <th mat-header-cell *matHeaderCellDef>Marca</th>
                            <td mat-cell *matCellDef="let m">{{ m.marca || '—' }}</td>
                        </ng-container>
                        <ng-container matColumnDef="modelo">
                            <th mat-header-cell *matHeaderCellDef>Modelo</th>
                            <td mat-cell *matCellDef="let m">{{ m.modelo || '—' }}</td>
                        </ng-container>
                        <ng-container matColumnDef="principal">
                            <th mat-header-cell *matHeaderCellDef>Principal</th>
                            <td mat-cell *matCellDef="let m">
                                <mat-icon>{{ m.es_principal ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
                            </td>
                        </ng-container>

                        <!-- Acciones -->
                        <ng-container matColumnDef="acciones">
                            <th mat-header-cell *matHeaderCellDef class="th-actions">Acciones</th>
                            <td mat-cell *matCellDef="let m" class="td-actions">
                                <button mat-icon-button (click)="editMonitor(m)" matTooltip="Editar monitor">
                                    <mat-icon>edit</mat-icon>
                                </button>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="['serial','marca','modelo','principal','acciones']"></tr>
                        <tr mat-row *matRowDef="let r; columns: ['serial','marca','modelo','principal','acciones'];">
                        </tr>
                    </table>
                </div>
            </mat-tab>

            <!-- TAB: Periféricos -->
            <mat-tab label="Periféricos" *ngIf="detail()?.perifericos?.length || true">
                <div class="dd-tab-scroll">
                    <div class="dd-section-toolbar">
                        <div class="dd-section-title">Periféricos</div>
                        <span class="dd-spacer"></span>
                        <button mat-flat-button color="primary" (click)="addPeriferico()">
                            <mat-icon>add</mat-icon>&nbsp;Agregar periférico
                        </button>
                    </div>

                    <table mat-table [dataSource]="detail()?.perifericos ?? []" class="inv-table">
                        <ng-container matColumnDef="tipo">
                            <th mat-header-cell *matHeaderCellDef>Tipo</th>
                            <td mat-cell *matCellDef="let p">{{ p.tipo || '—' }}</td>
                        </ng-container>
                        <ng-container matColumnDef="serial">
                            <th mat-header-cell *matHeaderCellDef>Serie</th>
                            <td mat-cell *matCellDef="let p">{{ p.serial || '—' }}</td>
                        </ng-container>
                        <ng-container matColumnDef="marca">
                            <th mat-header-cell *matHeaderCellDef>Marca</th>
                            <td mat-cell *matCellDef="let p">{{ p.marca || '—' }}</td>
                        </ng-container>
                        <ng-container matColumnDef="modelo">
                            <th mat-header-cell *matHeaderCellDef>Modelo</th>
                            <td mat-cell *matCellDef="let p">{{ p.modelo || '—' }}</td>
                        </ng-container>

                        <!-- Acciones -->
                        <ng-container matColumnDef="acciones">
                            <th mat-header-cell *matHeaderCellDef class="th-actions">Acciones</th>
                            <td mat-cell *matCellDef="let p" class="td-actions">
                                <button mat-icon-button (click)="editPeriferico(p)" matTooltip="Editar periférico">
                                    <mat-icon>edit</mat-icon>
                                </button>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="['tipo','serial','marca','modelo','acciones']"></tr>
                        <tr mat-row *matRowDef="let r; columns: ['tipo','serial','marca','modelo','acciones'];"></tr>
                    </table>
                </div>
            </mat-tab>
        </mat-tab-group>
    </ng-template>
</div>